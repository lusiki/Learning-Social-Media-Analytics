---
title: "<center><div class='mytitle'>Konkurenti u medijskom prostoru</div></center>"
author: "<center><div class='mysubtitle'>(Bosch, Braun, Phillips, Dyson)</div></center>"
date: ""
output:
  html_document:
    theme: yeti
    highlight: espresso
    toc: yes
    toc_depth: 4
    toc_float: yes
    keep_md: yes
    css: style.css
    includes:
      before_body: header.html
      after_body: footer.html
---

<div class="mycontent">

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache=TRUE)
```


```{r echo = FALSE, message=FALSE,warning=FALSE}
library(kableExtra)
library(ggplot2)
library(ggthemes)
library(scales)
library(tidyverse)
library(httr)
library(lubridate)
library(dplyr)
library(data.table)
library(tidytext)
library(plotly)
```


```{r echo = FALSE, message=FALSE,warning=FALSE}

source(here::here('Creds', 'api.R'))

#source("./Creds/api.R")
groups <- "185076"
keywords <- "6528081"
from_time <- as.character(as.numeric(as.POSIXlt("2021-10-06", format="%Y-%m-%d")))
to_time <- as.character(as.numeric(as.POSIXlt("2022-01-06", format="%Y-%m-%d")))
count <- 2700



probs <- paste0("https://api.mediatoolkit.com/organizations/126686/groups/",groups,
              "/keywords/",keywords,
              "/mentions?access_token=",token,
              "&from_time=",from_time,
              "&to_time=",to_time,
              "&count=",count,
              "&sort=time&type=all&offset=0&ids_only=false")

# POVUCI 
#options(timeout = 4000000) 

API_zahtjev <- httr::GET(probs)
jS_tekst <- httr::content(API_zahtjev, as = "text", type = "aplication/json", encoding = "UTF-8")
DF_za_analizu <- jsonlite::fromJSON(jS_tekst, flatten = TRUE)

dta <- data.frame(DF_za_analizu$data)

phillips <- dta %>%
  select(keyword = response.keywords,
         reach = response.reach,
         time = response.insert_time,
         description = response.description,
         type = response.type,
         title = response.title,
         mention = response.mention,
         from = response.from,
         author = response.author,
         url = response.url,
         domain = response.domain,
         comment = response.comment_count,
         engagement = response.engagement_rate,
         like = response.like_count,
         prValue = response.pr_value,
         virality = response.virality,
         share = response.share_count,
         interaction = response.interaction,
         ytID = response.youtube_channel_id, 
         txt = response.full_mention,
         view = response.view_count)
```


```{r echo = FALSE, message=FALSE,warning=FALSE}

options(digits = 2)
phillips %>%
  mutate(time = as_datetime(time),
         time = as.Date(time, format="%Y-%m-%d" )) %>%
  mutate(day = day(time)) %>%
  group_by(time) %>%
  summarize(mean_X1 = n()) %>%
  summarise(avg = mean(mean_X1)) -> avg

# phillips %>%
#   mutate(time = as_datetime(time),
#          time = as.Date(time, format="%Y-%m-%d" )) %>%
#   mutate(week = week (time)) %>%
#   group_by(week) %>%
#   summarize(mean_X1 = n()) %>%
#   summarise(avg = mean(mean_X1)) -> avg
```

<br>
<br>
<br>
<br>


# **Što je unutra?**

***


- cijeli hrvatski medijski prostor za četiri konkurenta **Bosch, Braun, Phillips, Dyson** 
<br><br>
- objave uključuju sve hrvatske društvene medije: *web, facebook, youtube, twitter, instagram, forum, reddit i komentare*
<br><br>
- sve medijske objave koje sadrže naziv branda u **razdoblju od tri mjeseca** (2021/10/06 do 2022/01/06)
<br><br>
- ukupno 2677 objava, odnosno `r avg` objava dnevno
<br><br>
- ukupno XXX riječi u svim tekstovima

<br>

# **Sadržaj**

***

<br>

- na početku izvještaja **skupni prikaz** medijskog prostora
<br><br>
- nakon toga opisani **izabrani mediji**
<br><br>
- potom analiziran sadržaj objava za **izabrane brandove**
<br><br>
- na kraju **najvažniji zaključci**

<br>

# **Skupni prikaz**

***

```{r echo = FALSE, message=FALSE,warning=FALSE}
options(digits = 2)
phillips %>%
  mutate(time = as_datetime(time),
         time = as.Date(time, format="%Y-%m-%d" )) %>%
  mutate(day = day(time)) %>%
  group_by(time) %>%
  summarize(mean_X1 = n()) %>%
  summarise(avg = mean(mean_X1)) -> avg

# phillips %>%
#   mutate(time = as_datetime(time),
#          time = as.Date(time, format="%Y-%m-%d" )) %>%
#   mutate(week = week (time)) %>%
#   group_by(week) %>%
#   summarize(mean_X1 = n()) %>%
#   summarise(avg = mean(mean_X1)) -> avg
```

<br>


- najveću medijsku prisutnost ima Bosch, nakon toga slijede Braun i Phillips, a na kraju Dyson
<br><br>
- tržišni lideri dominiraju na svakom pojedinačnom mediju i konzistentno kroz cijelo promatrano razdoblje


<br>

### **Brandovi**

***

<br>



```{r echo = FALSE, message=FALSE,warning=FALSE}

brandTxT <- phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) 




 
brandTitle <- phillips %>%
   mutate(kword = case_when(grepl("phill", title, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", title, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", title, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", title, ignore.case = TRUE) ~ "dyson"))


```



<div class = "row">

<div class = "col-sm-4">
<br><br>Bosch i Braun zajedno imaju više od 60% svih objava i znatno su zastupljeniji u medijskom prostoru od  Phillipsa i Dysona na koje odlazi manje od 15% svih objava. Pri tome je oko 25% svih objava nesvrstano jer je tekst objave anonimiziran.

</div>

  
<div class = "col-sm-2">
```{r echo = FALSE, message=FALSE,warning=FALSE}
options(digits = 2)
brandTitle %>% 
  group_by(kword) %>%
  summarise(N = n()) %>%
  ungroup() %>%
  mutate(Tot = sum(N), 
         'Udio %' = (N / Tot)*100) %>%
  select(-Tot) %>%
  arrange(desc(N)) %>%
  rename (Brand = kword,
          'Broj objava' = N) %>%
  kbl(caption = "Broj objava u naslovu:") %>%
    kable_paper(bootstrap_options = "striped",full_width = F, position = "float_right")
```

</div>
  
<div class = "col-sm-3">
<br><br>Zanimljivo je primijetiti da je Phillips na zadnjem mjestu po broju objava u kojima se riječ *Phillips* u naslovu objave te da je *Dyson* puno bliži *Braunu* prema ovom kriteriju.
</div>
  
<div class = "col-sm-3">
```{r, message=FALSE, echo=FALSE}
options(digits = 2)
brandTxT %>%
  group_by(kword) %>%
  summarise(N = n()) %>%
  ungroup() %>%
  mutate(Tot = sum(N), 
         'Udio %' = (N / Tot)*100) %>%
  select(-Tot) %>%
  arrange(desc(N)) %>%
  rename (Brand = kword,
          'Broj objava' = N) %>%
  kbl(caption = "Broj objava u tekstu:") %>%
    kable_paper(bootstrap_options = "striped",full_width = F,position = "float_left")
```
</div>
</div>


<br>
<br>

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height = 10, fig.width = 15, fig.align="center", fig.cap="Grafikon: Udio (%) u ukupnom broju dnevnih objava o brandu kroz vrijeme."}

brands <- c("phillips", "bosch", "braun", "dyson")

brandTxT %>%
  mutate(time = as_datetime(time),
         time = as.Date(time, format="%Y-%m-%d" )) %>% 
  group_by(time) %>%
  count(kword) %>% 
  filter(!is.na(kword)) %>%
  mutate(gn = sum(n)) %>% 
  ggplot(., aes(time, n / gn)) + 
  geom_bar(stat = "identity") +
  geom_line() + 
  ggtitle("") +
  ylab("") +
  xlab("") +
  facet_wrap(~ kword) +
  scale_y_continuous(labels = scales::percent_format()) +
  scale_x_date(labels = date_format("%d-%m")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
  panel.background = element_blank(), axis.line = element_line(colour = "black")) + 
  theme_economist() -> g1



ggplotly(g1)


```

<br>

Vremenska dinamika objava potvrđuje Bosch kao tržišnog lidera koji je postojano u rasponu od 50% do 80% svih objava na dnevnoj razini. Znatno veća volatilnost je karakteristična za Braun koji je najčešće ispod 25% dnevnih objava sa povremenim povećanjima medijske aktivnosti preko 50% na (otprilike) tjednoj razini. Phillips je je postojano ispod 20% dnevnih objava sa rijetkim epizodama povećane medijske aktivnosti od 50% i 25% ukupnih objava.

<br>


### **Mediji**

***

<br>

<div class = "row">

<div class = "col-sm-10">
<br><br>Najviše medijske aktivnosti (1041 objava) vezano uz četiri konkurenta je u na forumima. Nakon toga slijedi web sa 785 objava što ga čini najvažnijim medijskim prostorom. Nakon toga slijede instagram i facebook sa podjednakim brojem objava pri čemu ni youtube ne zaostaje mnogo. Uzevši u obzir da [se na youtube-u provodi više vremena (pažnje) po objavi nego na drugim medijima](https://datareportal.com/reports/digital-2021-croatia), ovo čini youtube izrazto važnim medijskim prostorom. Iako twitter nije jako popularan medij u Hrvatskoj, 144 objave su i dalje relevantan broj, pogotovo zbog kvalitetnije publike na ovoj mreži (koja je sklonija promovirati proizvod na osnovi kvalitete). Reddit i komentari nisu relevantan medij za analizirane konkurente jer na oba medija odlazi manje od 30 objava u cjelokupnom analiziranom razdoblju. Detaljan pregled se nalazi u tablici na desnoj strani.

</div>

<div class = "col-sm-2">
```{r echo = FALSE, message=FALSE,warning=FALSE}
phillips %>%
  group_by(type) %>%
  summarise(N = n()) %>%
  ungroup() %>%
  mutate(Tot = sum(N), 
         'Udio %' = (N / Tot)*100) %>%
  select(-Tot) %>%
  arrange(desc(N)) %>%
  rename(Medij = type,
          'Broj objava' = N) %>%
  kbl(caption = "Broj objava po medijima") %>%
    kable_paper(bootstrap_options = "striped",full_width = F, position = "right")

```
</div>
</div>


```{r echo = FALSE, eval=FALSE, include=FALSE, message=FALSE,warning=FALSE}

##### Pregled po brand-u (toolkit)
phillips %>%
  mutate(keyword = tolower(keyword)) %>%
  group_by(keyword) %>%
  summarise(N = n()) %>%
  arrange(desc(N)) %>%
  kable()

```



```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height = 8, fig.width = 12, fig.cap = "Grafikon: Udio (%) u ukupnom broju dnevnih objava po mediju kroz vrijeme."}

brandTxT %>%
  mutate(time = as_datetime(time),
         time = as.Date(time, format="%Y-%m-%d" )) %>% 
  group_by(time,type) %>%
  count() %>% 
#  filter(!is.na(kword)) %>%
  ungroup() %>%
  group_by(time) %>%
  mutate(gn = sum(n)) %>% 
  ggplot(., aes(time, n / gn)) + 
  geom_bar(stat = "identity") +
  geom_line() + 
  ggtitle("") +
  ylab("") +
  xlab("") +
  facet_wrap(~ type) +
  scale_y_continuous(labels = scales::percent_format()) +
  scale_x_date(labels = date_format("%d-%m")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
  panel.background = element_blank(), axis.line = element_line(colour = "black")) + 
  theme_economist() -> g2


ggplotly(g2)


```

<br>

Vremenska dinamika objava po medijima jasno ukazuje na znatan i postojan intenzitet objava na forumima na prosječnoj razini od 25% ukupne dnevne aktivnosti sa čestim povećanjima aktivnosti u valovima. Također je vidljiva postojana dinamika aktivnosti na facebook-u na razini od oko 10% dnevnih objava uz vrlo rijetka povećanja aktivnosti. Posebno je zanimljiva dinamika objava na web-u gdje se raspoznaje kostantna dnevna aktivnost na razini od oko 20% ukupnih dnavenih objava uz jedan period znatnog povećanja aktivnosti svakog mjseseca pred kraj/početak mjeseca. Slična dinamika je primjetna i na youtbe platformi uz znatno manji udio dnevnih objava. Usporedivi trendovi se raspoznaju i na twitter-u. 

<br>
 
### **Brand & medij**

***

<br>


Zastupljenost brand-ova po medijima je jednaka kao u cjelokupnom medijskom prostoru pa su općeniti lideri ujedno i lideri u svakom pojedinačnom mediju. I pak je zanimljivo prmijetiti da je prednopst koju ima Bosch naveća na forumima i youtube-u dok ja na web-u prednost Bosch-a i Braun-a u odnosu na Phillips znatno manja. Također, Dyson koji zauzima zadnju poziciju u ukupnom medijskom prostoru ima bolju poziciju na youtube-u.

<br>

```{r echo = FALSE, message=FALSE,warning=FALSE, fig.height = 8, fig.width = 13,fig.cap="Grafikon: Broj objava za medij i brand u cjelom razdoblju."}



phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) %>%
  group_by(type,kword) %>%
  summarise(N = n()) %>%
  arrange(desc(N)) %>%
  filter(!is.na(kword) ) %>%
  ggplot(., aes(kword, N)) + 
  geom_bar(stat = "identity") +
  geom_line() + 
  ggtitle("") +
  ylab("") +
  xlab("") +
  facet_wrap(~ type, scales = "free") + 
#  scale_y_continuous(labels = scales::percent_format()) +
#  scale_x_date(labels = date_format("%d-%m")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
  panel.background = element_blank(), axis.line = element_line(colour = "black")) + 
  theme_economist() -> g3

ggplotly(g3)


```

<br>

# **Izabrani mediji**

***

U ovom dijelu je dan pregled najvažnijih medija, odnosno web-a u youtube-a. Važnost web-a proizlazi iz obujma objava, a youtube-a zbog visokog fokusa (attention span) koji korisnici posvećuju sadržaju na ovoj platformi.

<br>

### **Web**

***

<br>



```{r landscapeFreqBrand, echo=FALSE, message=FALSE, warning=FALSE, fig.height = 10, fig.width=12}

phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) %>%
  group_by(domain,kword) %>%
  summarise(N = n()) %>%
  arrange(desc(N))  %>%
  filter(!is.na(domain)) %>%
  filter(N > 2) %>%
  filter(domain != "forum.hr")-> landscapeFreqBrand
  
landscapeFreqBrand %>%
  ggplot(., aes(x = reorder(domain,N), y = N)) +
  geom_bar(stat = "identity", alpha = 1) +
  facet_wrap(~kword, scales = "free") +
  ylab("Broj objava") +
  xlab("Izvor") +
  ggtitle("Pregled po domenama") +
#  theme_bw() 
  theme_economist()+
  coord_flip() -> g4

ggplotly(g4)

```

```{r , echo=FALSE, message=FALSE, warning=FALSE, fig.height = 10, fig.width=12}

phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) %>%
  group_by(domain,kword) %>%
  summarise(N =  sum(reach, na.rm = TRUE)) %>%
  arrange(desc(N))  %>%
  filter(!is.na(domain)) %>%
  filter(N > 2000) %>%
  filter(domain != "forum.hr")-> landscapeFreqBrand
  
landscapeFreqBrand %>%
  ggplot(., aes(x = reorder(domain,N), y = N)) +
  geom_bar(stat = "identity", alpha = 1) +
  facet_wrap(~kword, scales = "free") +
  ylab("Broj objava") +
  xlab("Izvor") +
  ggtitle("Pregled po domenama (reach)") +
#  theme_bw() 
  theme_economist() +
  coord_flip() -> g5

ggplotly(g5)
```

```{r , echo=FALSE, message=FALSE, warning=FALSE, fig.height = 10, fig.width=12}

phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) %>%
  group_by(domain,kword) %>%
  summarise(N =  sum(engagement, na.rm = TRUE)) %>%
  arrange(desc(N))  %>%
  filter(!is.na(domain)) %>%
  filter(N > 20) %>%
  filter(domain != "forum.hr")-> landscapeFreqBrand
  
landscapeFreqBrand %>%
  ggplot(., aes(x = reorder(domain,N), y = N)) +
  geom_bar(stat = "identity", alpha = 1) +
  facet_wrap(~kword, scales = "free") +
  ylab("Broj objava") +
  xlab("Izvor") +
  ggtitle("Pregled po domenama (engagement)") +
#  theme_bw() 
  theme_economist() +
  coord_flip() -> g6

ggplotly(g6)
```

```{r , echo=FALSE, message=FALSE, warning=FALSE, fig.height = 10, fig.width=12}

phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) %>%
  group_by(domain,kword) %>%
  summarise(N =  sum(prValue, na.rm = TRUE)) %>%
  arrange(desc(N))  %>%
  filter(!is.na(domain)) %>%
  filter(N > 20) %>%
  filter(domain != "forum.hr")-> landscapeFreqBrand
  
landscapeFreqBrand %>%
  ggplot(., aes(x = reorder(domain,N), y = N)) +
  geom_bar(stat = "identity", alpha = 1) +
  facet_wrap(~kword, scales = "free") +
  ylab("Broj objava") +
  xlab("Izvor") +
  ggtitle("Pregled po domenama (prValue)") +
#  theme_bw() 
  theme_economist() +
  coord_flip() -> g7

ggplotly(g7)
```

```{r , echo=FALSE, message=FALSE, warning=FALSE, fig.height = 10, fig.width=12}

phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) %>%
  group_by(domain,kword) %>%
  summarise(N =  sum(virality, na.rm = TRUE)) %>%
  arrange(desc(N))  %>%
  filter(!is.na(domain)) %>%
  filter(N > 2) %>%
  filter(domain != "forum.hr") -> landscapeFreqBrand
  
landscapeFreqBrand %>%
  ggplot(., aes(x = reorder(domain,N), y = N)) +
  geom_bar(stat = "identity", alpha = 1) +
  facet_wrap(~kword, scales = "free") +
  ylab("Broj objava") +
  xlab("Izvor") +
  ggtitle("Pregled po domenama (virality)") +
#  theme_bw() 
  theme_economist() +
  coord_flip() 
```


<br>

### **Youtube**

***

<br>

```{r , echo=FALSE, message=FALSE, warning=FALSE, fig.height = 10, fig.width=15}
phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) %>%
  filter(type == "youtube") %>%
  group_by(kword) %>%
  summarise(View =  sum(view, na.rm = TRUE),
            Comment =  sum(comment, na.rm = TRUE),
            Engagement =  sum(engagement, na.rm = TRUE),
            Like =  sum(like, na.rm = TRUE),
          #  Virality =  sum(virality, na.rm = TRUE),
            prValue =  sum(prValue, na.rm = TRUE)) %>%
  gather(Var, Val,-kword) %>%
  ggplot(., aes(x = kword, y = Val)) +
  geom_bar(stat = "identity", alpha = 1) +
  facet_wrap(~ Var, scales = "free") +
  ylab("Broj objava") +
  xlab("Izvor") +
  ggtitle("Pregled po domenama (virality)") +
#  theme_bw() 
  theme_economist() -> g8

ggplotly(g8)
  
 
```


```{r , echo=FALSE, message=FALSE, warning=FALSE, fig.height = 8, fig.width=5}
phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) %>%
  filter(type == "youtube") %>%
  group_by(kword,author) %>%
  summarise(View =  sum(view, na.rm = TRUE),
            Comment =  sum(comment, na.rm = TRUE),
        #    Engagement =  sum(engagement, na.rm = TRUE),
            Like =  sum(like, na.rm = TRUE),
        #    Virality =  sum(virality, na.rm = TRUE),
        #    prValue =  sum(prValue, na.rm = TRUE)
        ) %>%
  arrange(desc(View)) %>%
  rename (Brand = kword,
          'Autor' = author) %>%
  kbl(caption = "Pokazatellji aktivnosti na YouTube") %>%
    kable_paper(bootstrap_options = "striped",full_width = F, position = "left")  %>%
     scroll_box(width = "450px", height = "700px") 
  
```


<br>

# **Izabrani brandovi**

***

<br>



```{r lexicon, echo=FALSE, message=FALSE, warning=FALSE}
## M-Files ----
# function to parse JSON from http conenctiion
parseJSON <- function(x) {
  xCon <- content(x, as = "text", type = "aplication/json", encoding = "UTF-8")
  xCon <- jsonlite::fromJSON(xCon, flatten = TRUE)
  xCon
}
# GET REST API function M-Files
mfiles_get <- function(token, resource){
  req <- GET(url = paste0('http://server.contentio.biz/REST', resource),
             add_headers('X-Authentication' = token, 'content-type' = "application/json"))
  result <- parseJSON(req)
  return(result)
}
# GET token M-Files
req <- POST(url = 'http://server.contentio.biz/REST/server/authenticationtokens.aspx', 
            config = add_headers('content-type' = "application/json"),
            body = list(Username = "msagovac", Password = "Wc8O10TaHz40",
                        VaultGuid = "{7145BCEB-8FE2-4278-AD3B-7AE70374FF8A}",
                        ComputerName  = "CT-VM-01"),
            encode = "json", verbose())
token <- parseJSON(req)[[1]]
# M-FILES DOWNLOAD FILES
mfiles_downlaod <- function(objType, objId, fileId) {
  req <- GET(url = paste0('http://server.contentio.biz/REST/objects/', objType, '/', 
                          objId, '/latest/files/',fileId , '/content'),
             add_headers('X-Authentication' = token))
  reqCon <- content(req, as = "text", encoding = "UTF-8")
  if (is.na(reqCon)) {
    reqCon <- content(req, as = "raw", encoding = "UTF-8")
    reqCon <- rawToChar(reqCon, multiple = FALSE)
    reqCon <- iconv(reqCon, "", "UTF-8")
  }
  reqCon
}
mfiles_downlaod_txt <- function(objType, objId, fileId, ext = ".csv") {
  req <- GET(url = paste0('http://server.contentio.biz/REST/objects/', objType, '/', 
                          objId, '/latest/files/',fileId , '/content'),
             add_headers('X-Authentication' = token))
  reqCon <- httr::content(req)
  tempFileSave <- paste0(tempfile(), ext)
  writeBin(reqCon, tempFileSave)
  return(tempFileSave)
}
# GET classess, props and others
prop <- mfiles_get(token, "/structure/properties")
prop <- prop %>% 
  select(DataType, ID, Name, ObjectType) %>% 
  dplyr::arrange(Name)
objs <- mfiles_get(token, "/structure/objecttypes")
mfilesClass <- mfiles_get(token, "/structure/classes")
CroSentilex_n <- read.delim(mfiles_downlaod_txt("0", 136679, 136711, ext = ".txt"),
                            header = FALSE,
                            sep = " ",
                            stringsAsFactors = FALSE) %>% 
  rename(word = "V1", sentiment = "V2" ) %>%
  mutate(brija = "NEG")
CroSentilex_p <- read.delim(mfiles_downlaod_txt("0", 136681, 136713, ext = ".txt"),
                            header = FALSE,
                            sep = " ",
                            stringsAsFactors = FALSE) %>% 
  rename(word = "V1", sentiment = "V2" ) %>%
  mutate(brija = "POZ")
Crosentilex_sve <- rbind(setDT(CroSentilex_n), setDT(CroSentilex_p))
#head(Crosentilex_sve)
CroSentilex_Gold  <- read.delim2(mfiles_downlaod_txt("0", 136680, 136712, ext = ".txt"),
                                 header = FALSE,
                                 sep = " ",
                                 stringsAsFactors = FALSE) %>%
  rename(word = "V1", sentiment = "V2" ) 
CroSentilex_Gold[1,1] <- "dati"
CroSentilex_Gold$sentiment <- str_replace(CroSentilex_Gold$sentiment , "-", "1")
CroSentilex_Gold$sentiment <- str_replace(CroSentilex_Gold$sentiment , "\\+", "2")
CroSentilex_Gold$sentiment <- as.numeric(unlist(CroSentilex_Gold$sentiment))
#head(CroSentilex_Gold)
# leksikoni
stopwords_cro <- get_stopwords(language = "hr", source = "stopwords-iso")
my_stop_words <- tibble(
  word = c(
    "jedan",
    "e","prvi", "dva","dvije","drugi",
    "tri","tre?i","pet","kod",
    "ove","ova",  "ovo","bez",
    "evo","oko",  "om", "ek",
    "mil","tko","?est", "sedam",
    "osam",   "?im", "zbog",
    "prema", "dok","zato", "koji", 
    "im", "?ak","me?u", "tek",
    "koliko", "tko","kod","poput", 
    "ba?", "dakle", "osim", "svih", 
    "svoju", "odnosno", "gdje",
    "kojoj", "ovi", "toga","ima","treba","sad","to","kad", "?e","ovaj","?ta","onda","ce","ko"
  ),
  lexicon = "lux"
)
stop_corpus <- my_stop_words %>%
  bind_rows(stopwords_cro)
```

<br>

### **Bosch** 

***

<br>

```{r , echo=FALSE, message=FALSE, warning=FALSE, fig.height = 10, fig.width=15}

phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) %>%
  filter(type == "web" & kword == "bosch") %>%
  unnest_tokens(word, mention) %>%
  anti_join(stop_corpus, by = "word") %>%
  mutate(word = gsub("\\d+", NA, word)) %>%
  mutate(word = gsub("^[a-zA-Z]$", NA, word)) %>%
  filter(!is.na(word)) -> rijeci_clean
```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height = 10, fig.width=5}

rijeci_clean %>%
#  filter(word %in% c("xiaomi","samsung","vivo","huawei")) %>%
  group_by(word) %>%
  summarise(#View =  sum(view, na.rm = TRUE),
            Comment =  sum(comment, na.rm = TRUE),
            Engagement =  sum(engagement, na.rm = TRUE),
            Like =  sum(like, na.rm = TRUE),
          #  Virality =  sum(virality, na.rm = TRUE),
          #  prValue =  sum(prValue, na.rm = TRUE),
            n = n()) %>%
  arrange(desc(n))-> freqOFmention


freqOFmention %>%
  rename (Brand = word,
          'Number of mentions' = n) %>%
  kbl(caption = "Najčešće riječi na YouTubee o brandu Phillips") %>%
    kable_paper(bootstrap_options = "striped",full_width = F, position = "left")  %>%
     scroll_box(width = "550px", height = "700px") 



```


<br>

### **Phillips**

***

<br>


```{r , echo=FALSE, message=FALSE, warning=FALSE, fig.height = 10, fig.width=15}

phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) %>%
  filter(type == "forum" & kword == "phillips") %>%
  unnest_tokens(word, mention) %>%
  anti_join(stop_corpus, by = "word") %>%
  mutate(word = gsub("\\d+", NA, word)) %>%
  mutate(word = gsub("^[a-zA-Z]$", NA, word)) %>%
  filter(!is.na(word)) -> rijeci_clean
```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height = 10, fig.width=5}

rijeci_clean %>%
#  filter(word %in% c("xiaomi","samsung","vivo","huawei")) %>%
  group_by(word) %>%
  summarise(View =  sum(view, na.rm = TRUE),
            Comment =  sum(comment, na.rm = TRUE),
            Engagement =  sum(engagement, na.rm = TRUE),
            Like =  sum(like, na.rm = TRUE),
          #  Virality =  sum(virality, na.rm = TRUE),
          #  prValue =  sum(prValue, na.rm = TRUE),
            n = n()) %>%
  arrange(desc(n))-> freqOFmention


freqOFmention %>%
  rename (Brand = word,
          'Number of mentions' = n) %>%
  kbl(caption = "Najčešće riječi na forumima o brandu Phillips") %>%
    kable_paper(bootstrap_options = "striped",full_width = F, position = "left")  %>%
     scroll_box(width = "550px", height = "700px") 

```




<br>

# **Glavni zaključci**

***

<br>


<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 20px;}
</style>
<div class = "blue">

- Tržišni lider u medijskom prostoru je Bosch
- Braun slijedi nakon toga, a Phillips zaostaje
- U prosjeku ima oko 30 objava dnevno 
- Najviše se objavljuje na forumima i Web-u
- Najrelevantniji mediji su web i youtube

</div>


</div>





