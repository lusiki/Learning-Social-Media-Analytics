---
title: "<center><div class='mytitle'>Analiza konkurencije u medijskom prostoru</div></center>"
author: "<center><div class='mysubtitle'>Subjekt: PHILLIPS SDA, Q4 2021</div></center>"
date: "<center><div class='mysubtitle'>Konkurenti: Bosch, Braun, Dyson</div></center>"
output:
  html_document:
    theme: yeti
    highlight: espresso
    toc: yes
    toc_depth: 4
    toc_float: yes
    keep_md: yes
    css: style.css
    includes:
      before_body: header.html
      after_body: footer.html
---

<div class="mycontent">

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = F)
```


```{r echo = FALSE, message=FALSE,warning=FALSE}
library(kableExtra)
library(ggplot2)
library(ggthemes)
library(scales)
library(tidyverse)
library(httr)
library(lubridate)
library(dplyr)
library(data.table)
library(tidytext)
library(plotly)
```


```{r echo = FALSE, message=FALSE,warning=FALSE}

source(here::here('Creds', 'api.R'))

#source("./Creds/api.R")
groups <- "185076"
keywords <- "6528081"
from_time <- as.character(as.numeric(as.POSIXlt("2021-10-06", format="%Y-%m-%d")))
to_time <- as.character(as.numeric(as.POSIXlt("2022-01-06", format="%Y-%m-%d")))
count <- 2700



probs <- paste0("https://api.mediatoolkit.com/organizations/126686/groups/",groups,
              "/keywords/",keywords,
              "/mentions?access_token=",token,
              "&from_time=",from_time,
              "&to_time=",to_time,
              "&count=",count,
              "&sort=time&type=all&offset=0&ids_only=false")

# POVUCI 
#options(timeout = 4000000) 

API_zahtjev <- httr::GET(probs)
jS_tekst <- httr::content(API_zahtjev, as = "text", type = "aplication/json", encoding = "UTF-8")
DF_za_analizu <- jsonlite::fromJSON(jS_tekst, flatten = TRUE)

dta <- data.frame(DF_za_analizu$data)

phillips <- dta %>%
  select(keyword = response.keywords,
         reach = response.reach,
         time = response.insert_time,
         description = response.description,
         type = response.type,
         title = response.title,
         mention = response.mention,
         from = response.from,
         author = response.author,
         url = response.url,
         domain = response.domain,
         comment = response.comment_count,
         engagement = response.engagement_rate,
         like = response.like_count,
         prValue = response.pr_value,
         virality = response.virality,
         share = response.share_count,
         interaction = response.interaction,
         ytID = response.youtube_channel_id, 
         txt = response.full_mention,
         view = response.view_count)
```


```{r echo = FALSE, message=FALSE,warning=FALSE}

options(digits = 2)
phillips %>%
  mutate(time = as_datetime(time),
         time = as.Date(time, format="%Y-%m-%d" )) %>%
  mutate(day = day(time),
        (week = week(time))) %>%
  group_by(time) %>%
  summarize(mean_X1 = n()) %>%
  summarise(avg = mean(mean_X1)) -> avg

# phillips %>%
#   mutate(time = as_datetime(time),
#          time = as.Date(time, format="%Y-%m-%d" )) %>%
#   mutate(week = week (time)) %>%
#   group_by(week) %>%
#   summarize(mean_X1 = n()) %>%
#   summarise(avg = mean(mean_X1)) -> avg
```



<br>
<br>


# **Što je unutra?**

***


- cijeli hrvatski medijski prostor za četiri konkurenta **Bosch, Braun, Phillips, Dyson** 
<br><br>
- objave uključuju sve hrvatske društvene medije: *web, facebook, youtube, twitter, instagram, forum, reddit i komentare*
<br><br>
- sve medijske objave koje sadrže naziv branda u **razdoblju od tri mjeseca** (2021/10/06 do 2022/01/06)
<br><br>
- ukupno 2677 objava, odnosno `r avg` objava dnevno
<br><br>
- ukupno XXX riječi u svim tekstovima

<br>

# **Sadržaj**

***

<br>

- na početku izvještaja **skupni prikaz** medijskog prostora
<br><br>
- nakon toga opisani **izabrani mediji**
<br><br>
- potom analiziran sadržaj objava za **izabrane brandove**
<br><br>
- na kraju **najvažniji zaključci**

<br>

# **Skupni prikaz**

***

```{r echo = FALSE, message=FALSE,warning=FALSE}
options(digits = 2)
phillips %>%
  mutate(time = as_datetime(time),
         time = as.Date(time, format="%Y-%m-%d" )) %>%
  mutate(day = day(time)) %>%
  group_by(time) %>%
  summarize(mean_X1 = n()) %>%
  summarise(avg = mean(mean_X1)) -> avg

# phillips %>%
#   mutate(time = as_datetime(time),
#          time = as.Date(time, format="%Y-%m-%d" )) %>%
#   mutate(week = week (time)) %>%
#   group_by(week) %>%
#   summarize(mean_X1 = n()) %>%
#   summarise(avg = mean(mean_X1)) -> avg
```

<br>


- najveću medijsku prisutnost ima *Bosch*, nakon toga slijede *Braun* i *Phillips*, a na kraju *Dyson*
<br><br>
- tržišni lideri dominiraju na svakom pojedinačnom mediju i konzistentno kroz cijelo promatrano razdoblje
<br><br>
- najvažniji medij je Web, najviše aktivnosti na forumima, a najveći prostor za rast YouTube

<br>

### **Brandovi**

***

<br>



```{r echo = FALSE, message=FALSE,warning=FALSE}

brandTxT <- phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) 




 
brandTitle <- phillips %>%
   mutate(kword = case_when(grepl("phill", title, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", title, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", title, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", title, ignore.case = TRUE) ~ "dyson"))


```



<div class = "row">

<div class = "col-sm-4">
- 60% svih objava imaju Bosch i Braun 
<br>
- manje od 15% odlazi na Phillips i Dyson 
<br>
- 25% svih objava ne sadrži riječ u tekstu (umanjena vrijednost objave)

</div>

  
<div class = "col-sm-2">
<br>
```{r, message=FALSE, echo=FALSE}
options(digits = 2)
brandTxT %>%
  group_by(kword) %>%
  summarise(N = n()) %>%
  ungroup() %>%
  mutate(Tot = sum(N), 
         'Udio %' = (N / Tot)*100) %>%
  mutate(kword=replace_na(kword, "no brand"))  %>%
  select(-Tot) %>%
  arrange(desc(N)) %>%
  rename (Brand = kword,
          'Broj objava' = N) %>%
  kbl(caption = "Broj objava u tekstu") %>%
    kable_paper(bootstrap_options = "striped",full_width = F,position = "float_left") %>%
footnote(general = "")
```

</div>
  
<div class = "col-sm-4">
- *Phillips* je na zadnjem mjestu po broju objava u naslovu (niska vidljivost branda) 
<br>
- *Dyson* puno bliži *Braunu* prema broju objava u naslovu (bolja pozicioniranost od Phillips-a)
<br>
- 91% svih objava ne sadrži riječ u naslovu (potencijal za rast prisutnosti)
</div>
  
<div class = "col-sm-2">
<br>
```{r echo = FALSE, message=FALSE,warning=FALSE}
options(digits = 2)
brandTitle %>% 
  group_by(kword) %>%
  summarise(N = n()) %>%
  ungroup() %>%
  mutate(Tot = sum(N), 
         'Udio %' = (N / Tot)*100) %>%
  mutate(kword=replace_na(kword, "no brand"))  %>%
  select(-Tot) %>%
  arrange(desc(N)) %>%
  rename (Brand = kword,
          'Broj objava' = N) %>%
  kbl(caption = "Broj objava u naslovu: ") %>%
    kable_paper(bootstrap_options = "striped",full_width = F, position = "float_right") %>%
footnote()
```

</div>
</div>


<br>
<br>


<button class="btn btn-primary" data-toggle="collapse" data-target="#Block1"> Grafikon: Udio (%) u ukupnom broju tjednih objava o brandu kroz vrijeme. </button>  
<div id="Block1" class="collapse">


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height = 6, fig.width = 9, fig.align="center", fig.cap="Grafikon: Udio (%) u ukupnom broju tjednih objava o brandu kroz vrijeme."}

brands <- c("phillips", "bosch", "braun", "dyson")

cbp1 <- c("#999999", "#E69F00", "#56B4E9", "#009E73",
          "#F0E442", "#0072B2", "#D55E00", "#CC79A7")


brandTxT %>%
  mutate(time = as_datetime(time),
         time = as.Date(time, format="%Y-%m-%d"),
         week = floor_date(time, "week")) %>% 
  group_by(week) %>%
  count(kword) %>% 
  filter(!is.na(kword)) %>%
  mutate(gn = sum(n)) %>% 
  ggplot(., aes(week, n / gn, fill=kword)) + 
  geom_bar(stat = "identity") +
  geom_line(size = 0.9) + 
  ggtitle("") +
  ylab("Ukupnih objava") +
  xlab("") +
  facet_wrap(~ kword) + 
  scale_fill_manual(values = cbp1) +
  scale_colour_manual(values=cbp1) +
  scale_y_continuous(labels = scales::percent_format()) +
  scale_x_date(labels = date_format("%d-%m")) +
  theme_economist(base_family="Verdana") +
    theme(
      legend.position="none",
      panel.spacing = unit(0, "lines"),
      strip.text.x = element_text(size = 5),
      plot.title = element_text(size=13)) -> g1





ggplotly(g1)


```

</div>

<br>

- Vremenski također pregled potvrđuje Bosch kao tržišnog lidera
<br>
- *Bosch* je postojano u rasponu od 50% do 80% svih objava na tjednoj razini
<br>
- Znatno veća volatilnost objava za Braun 
<br>
- *Braun* oko ili ispod 25% tjednih objava sa povremenim povećanjima medijske aktivnosti preko 50% 
<br>
- *Phillips* postojano ispod 20% dnevnih objava sa rijetkim epizodama povećane medijske aktivnosti od 50% i 25%

<br>


### **Mediji**

***

<br>

<div class = "row">

<div class = "col-sm-10">

- Najviše aktivnosti na forumima
<br>
- Nakon toga web 
<br>
- Manji udjeli na društvenim medijima i YouTube-u ostavljaju velik prostor za napredak
<br>

</div>

<div class = "col-sm-2">

```{r echo = FALSE, message=FALSE,warning=FALSE}
phillips %>%
  group_by(type) %>%
  summarise(N = n()) %>%
  ungroup() %>%
  mutate(Tot = sum(N), 
         'Udio %' = (N / Tot)*100) %>%
  select(-Tot) %>%
  arrange(desc(N)) %>%
  filter(type != "comment") %>%
  rename(Medij = type,
          'Broj objava' = N) %>%
  kbl(caption = "Broj objava po medijima") %>%
    kable_paper(bootstrap_options = "striped",full_width = F, position = "right")

```
</div>
</div>

```{r echo = FALSE, eval=FALSE, include=FALSE, message=FALSE,warning=FALSE}

##### Pregled po brand-u (toolkit)
phillips %>%
  mutate(keyword = tolower(keyword)) %>%
  group_by(keyword) %>%
  summarise(N = n()) %>%
  arrange(desc(N)) %>%
  kable()

```

<br>



<button class="btn btn-primary" data-toggle="collapse" data-target="#Block2"> Grafikon: Udio (%) u ukupnom broju tjednih objava po mediju kroz vrijeme. </button>  
<div id="Block2" class="collapse">


```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height = 6, fig.width = 9, fig.cap = "Grafikon: Udio (%) u ukupnom broju tjednih objava po mediju kroz vrijeme."}

brandTxT %>%
  mutate(time = as_datetime(time),
         time = as.Date(time, format="%Y-%m-%d" ),
         week = floor_date(time,"week")) %>% 
  group_by(week,type) %>%
  count() %>% 
#  filter(!is.na(kword)) %>%
  ungroup() %>%
  group_by(week) %>%
  mutate(gn = sum(n)) %>% 
  ggplot(., aes(week, n / gn, fill = type)) + 
  geom_bar(stat = "identity") +
  geom_line() + 
  ggtitle("") +
  ylab("Ukupnih objava") +
  xlab("") +
  facet_wrap(~ type) +
  scale_y_continuous(labels = scales::percent_format()) +
  scale_x_date(labels = date_format("%d-%m")) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
  panel.background = element_blank(), axis.line = element_line(colour = "black")) + 
  scale_fill_manual(values = cbp1) +
  scale_colour_manual(values=cbp1) +
  theme_economist(base_family="Verdana") +
    theme(
      legend.position="none",
      panel.spacing = unit(0, "lines"),
      strip.text.x = element_text(size = 4),
      plot.title = element_text(size=13)) -> g2



ggplotly(g2)


```

</div>

<br>

- Znatan i postojan intenzitet objava na forumima sa čestim povećanjima aktivnosti u valovima
<br> 
- Postojana dinamika aktivnosti na Facebook-u uz vrlo rijetka povećanja aktivnosti
<br>
- Tjedne objave na web-u na razini od oko 20% ukupnih objava uz povećanja aktivnosti pred kraj/početak mjeseca
<br>
- Slična dinamika je primjetna i na YouTube-u uz znatno manji udio tjednih objava
<br>
- Usporedivi trendovi i na twitteru. 

<br>
 
### **Brand & medij**

***

<br>

- Zastupljenost brandova u pojedinačnim medijima je jednaka kao u cjelokupnom medijskom prostoru
<br>
- Bosch ima najveću prednost na forumima i YouTube-u
<br>
- Na web-u je prednost Bosch-a i Braun-a u odnosu na Phillips znatno manja
<br>
- Dyson zauzima zadnju poziciju u ukupnom medijskom prostoru, ali ima bolju poziciju na YouTube od Phillipsa

<br>


<button class="btn btn-primary" data-toggle="collapse" data-target="#Block3"> Grafikon: Broj objava za medij i brand u cjelom razdoblju. </button>  
<div id="Block3" class="collapse">

```{r echo = FALSE, message=FALSE,warning=FALSE, fig.height = 6, fig.width = 9,fig.cap="Grafikon: Broj objava za medij i brand u cjelom razdoblju."}



phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) %>%
  group_by(type,kword) %>%
  summarise(N = n()) %>%
  arrange(desc(N)) %>%
  filter(!is.na(kword) ) %>%
  ggplot(., aes(kword, N, fill=kword)) + 
  geom_bar(stat = "identity") +
  geom_line() + 
  ggtitle("") +
  ylab("") +
  xlab("") +
  facet_wrap(~ type, scales = "free") + 
#  scale_y_continuous(labels = scales::percent_format()) +
#  scale_x_date(labels = date_format("%d-%m")) +
#  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
#  panel.background = element_blank(), axis.line = element_line(colour = "black")) + 
  scale_fill_manual(values = cbp1) +
  scale_colour_manual(values=cbp1) +
  theme_economist(base_family="Verdana") +
    theme(
      legend.position="none",
      panel.spacing = unit(0, "lines"),
      strip.text.x = element_text(size = 8),
      plot.title = element_text(size=13)) -> g3

ggplotly(g3)


```

</div>

<br>

# **Izabrani mediji**

***

<br>

- Web i YouTube zbog visokog fokusa (attention span) korisnika

<br>

### **Web**

***

<br>

- Bosch i Braun jako prisutni na e-commmerce stranicama 
<br>
- Philips najviše prisutan na portalima, detaljnije u tekstu 

<br>
<br>
Pregled objava po domenama je izrazito informativan. Prvi grafikon prikazuje ukupan broj objava prema web izvorima za sve brandove. Za tržišne lidere Bosch i Braun ali i Dyson je vidljiva važnost e-commmerce stranica i preprodavača tehnike različite vrste poput mall.hr, rog-joma.hr, elipso.hr i dr. Sa druge strane, za Philips najveću važnost imaju popularni portali za informiranje poput index.hr, 24sata.hr, jutarnji.hr, a slika ostaje ista kada se promatraju drugi kriteriji važnosti poput dosega objava (reach), PR  važnosti, angažiranosti. Kod tržišnih lidera je situacija nešto drugačija i oni koriste različite medije za postizanje specifičnih ciljeva prepoznatljivosti na web-u.

<br>


<button class="btn btn-primary" data-toggle="collapse" data-target="#Block4"> Grafikon:  Broj objava prema web izvorima za sve brandove. </button>  
<div id="Block4" class="collapse">


```{r landscapeFreqBrand, echo=FALSE, message=FALSE, warning=FALSE, fig.height = 9, fig.width=9 , fig.cap="Grafikon: Broj objava po domenama."}

phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) %>%
  group_by(domain,kword) %>%
  summarise(N = n()) %>%
  arrange(desc(N))  %>%
  filter(!is.na(domain)) %>%
  filter(N > 2) %>%
  filter(domain != "forum.hr")-> landscapeFreqBrand
  
landscapeFreqBrand %>%
  ggplot(., aes(x = reorder(domain,N), y = N, fill = kword)) +
  geom_bar(stat = "identity", alpha = 1) +
  facet_wrap(~kword, scales = "free") +
  ylab("Broj objava") +
  xlab("") +
  ggtitle("Pregled po domenama") + 
  scale_fill_manual(values = cbp1) +
  scale_colour_manual(values=cbp1) +
  theme_economist(base_family="Verdana") +
    theme(
      legend.position="none",
      panel.spacing = unit(0, "lines"),
      strip.text.x = element_text(size = 5),
      plot.title = element_text(size=8)) +
  coord_flip() -> g4

ggplotly(g4)

```

</div>

<br>

<button class="btn btn-primary" data-toggle="collapse" data-target="#Block5"> Grafikon: Broj objava prema web izvorima po kriteriju dosega (reach). </button>  
<div id="Block5" class="collapse">

```{r , echo=FALSE, message=FALSE, warning=FALSE, fig.height = 9, fig.width=9, fig.cap="Grafikon: Broj objava po domenama prema kriteriju dosega (reach)."}

phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) %>%
  group_by(domain,kword) %>%
  summarise(N =  sum(reach, na.rm = TRUE)) %>%
  arrange(desc(N))  %>%
  filter(!is.na(domain)) %>%
  filter(N > 2000) %>%
  filter(domain != "forum.hr")-> landscapeFreqBrand
  
landscapeFreqBrand %>%
  ggplot(., aes(x = reorder(domain,N), y = N, fill = kword)) +
  geom_bar(stat = "identity", alpha = 1) +
  facet_wrap(~kword, scales = "free") +
  ylab("Broj objava") +
  xlab("Izvor") +
  ggtitle("") + 
  scale_fill_manual(values = cbp1) +
  scale_colour_manual(values=cbp1) +
  theme_economist(base_family="Verdana") +
    theme(
      legend.position="none",
      panel.spacing = unit(0, "lines"),
      strip.text.x = element_text(size = 5),
      plot.title = element_text(size=8))  +
  coord_flip() -> g5

ggplotly(g5)
```
</div>

<br>


<button class="btn btn-primary" data-toggle="collapse" data-target="#Block6"> Grafikon: Broj objava prema web izvorima po kriteriju angažiranosti (engagement). </button>  
<div id="Block6" class="collapse">


```{r , echo=FALSE, message=FALSE, warning=FALSE, fig.height = 9, fig.width=9, fig.cap="Grafikon: Broj objava po domenama prema kriteriju angažiranosti (engagement)."}

phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) %>%
  group_by(domain,kword) %>%
  summarise(N =  sum(engagement, na.rm = TRUE)) %>%
  arrange(desc(N))  %>%
  filter(!is.na(domain)) %>%
  filter(N > 20) %>%
  filter(domain != "forum.hr")-> landscapeFreqBrand
  
landscapeFreqBrand %>%
  ggplot(., aes(x = reorder(domain,N), y = N, fill = kword)) +
  geom_bar(stat = "identity", alpha = 1) +
  facet_wrap(~kword, scales = "free") +
  ylab("Broj objava") +
  xlab("Izvor") +
  ggtitle("") + 
  scale_fill_manual(values = cbp1) +
  scale_colour_manual(values=cbp1) +
  theme_economist(base_family="Verdana") +
    theme(
      legend.position="none",
      panel.spacing = unit(0, "lines"),
      strip.text.x = element_text(size = 5),
      plot.title = element_text(size=8)) +
  coord_flip() -> g6

ggplotly(g6)
```

</div>

<br>


<button class="btn btn-primary" data-toggle="collapse" data-target="#Block7"> Grafikon: Broj objava prema web izvorima po kriteriju PR vrijednosti. </button>  
<div id="Block7" class="collapse">


```{r , echo=FALSE, message=FALSE, warning=FALSE, fig.height = 9, fig.width=9, fig.cap="Grafikon: Broj objava po domenama prema kriteriju PR vrijednosti."}

phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) %>%
  group_by(domain,kword) %>%
  summarise(N =  sum(prValue, na.rm = TRUE)) %>%
  arrange(desc(N))  %>%
  filter(!is.na(domain)) %>%
  filter(N > 20) %>%
  filter(domain != "forum.hr")-> landscapeFreqBrand
  
landscapeFreqBrand %>%
  ggplot(., aes(x = reorder(domain,N), y = N, fill = kword)) +
  geom_bar(stat = "identity", alpha = 1) +
  facet_wrap(~kword, scales = "free") +
  ylab("Broj objava") +
  xlab("Izvor") +
  ggtitle("") + 
  scale_fill_manual(values = cbp1) +
  scale_colour_manual(values=cbp1) +
  theme_economist(base_family="Verdana") +
    theme(
      legend.position="none",
      panel.spacing = unit(0, "lines"),
      strip.text.x = element_text(size = 5),
      plot.title = element_text(size=8)) +
  coord_flip() -> g7

ggplotly(g7)
```

</div>

<br>

<button class="btn btn-primary" data-toggle="collapse" data-target="#Block8"> Grafikon: Broj objava prema web izvorima po kriteriju viralnosti. </button>  
<div id="Block8" class="collapse">  

```{r , echo=FALSE, message=FALSE, warning=FALSE, fig.height = 9, fig.width=9, fig.cap="Grafikon: Broj objava po domenama prema kriteriju viralnosti."}

phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) %>%
  group_by(domain,kword) %>%
  summarise(N =  sum(virality, na.rm = TRUE)) %>%
  arrange(desc(N))  %>%
  filter(!is.na(domain)) %>%
  filter(N > 2) %>%
  filter(domain != "forum.hr") -> landscapeFreqBrand
  
landscapeFreqBrand %>%
  ggplot(., aes(x = reorder(domain,N), y = N, fill = kword)) +
  geom_bar(stat = "identity", alpha = 1) +
  facet_wrap(~kword, scales = "free") +
  ylab("Broj objava") +
  xlab("Izvor") +
  ggtitle("") + 
  scale_fill_manual(values = cbp1) +
  scale_colour_manual(values=cbp1) +
  theme_economist(base_family="Verdana") +
    theme(
      legend.position="none",
      panel.spacing = unit(0, "lines"),
      strip.text.x = element_text(size = 5),
      plot.title = element_text(size=8)) +
  coord_flip()-> g8

ggplotly(g8) 
```

</div>


<br>

### **Youtube**

***

<br>

- Bosch je najzastupljeniji brand na YouTube prema svim pokazateljima i znatno nadmašuje konkurente
<br>
Važno je primijetiti da Dyson ima znatno bolju poziciju od Phillipsa na ovoj platformi prema svim pokazateljima osim broju komentara.

<br>


<button class="btn btn-primary" data-toggle="collapse" data-target="#Block9"> Grafikon: Pregled prema vrsti aktivnosti na YouTube platformi. </button>  
<div id="Block9" class="collapse"> 

```{r , echo=FALSE, message=FALSE, warning=FALSE, fig.height = 9, fig.width=9,fig.cap="Grafikon: Pregled prema vrsti aktivnosti na YouTube platformi."}
phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) %>%
  filter(type == "youtube") %>%
  group_by(kword) %>%
  summarise(View =  sum(view, na.rm = TRUE),
            Comment =  sum(comment, na.rm = TRUE),
            Engagement =  sum(engagement, na.rm = TRUE),
            Like =  sum(like, na.rm = TRUE),
          #  Virality =  sum(virality, na.rm = TRUE),
            prValue =  sum(prValue, na.rm = TRUE)) %>%
  gather(Var, Val,-kword) %>%
  ggplot(., aes(x = kword, y = Val, fill = Var)) +
  geom_bar(stat = "identity", alpha = 1) +
  facet_wrap(~ Var, scales = "free") +
  ylab("Broj objava") +
  xlab("") + 
  scale_fill_manual(values = cbp1) +
  scale_colour_manual(values=cbp1) +
  theme_economist(base_family="Verdana") +
    theme(
      legend.position="none",
      panel.spacing = unit(0, "lines"),
      strip.text.x = element_text(size = 10),
      plot.title = element_text(size=8)) -> g8

ggplotly(g8)
  
 
```

</div>

<br>

- Bosch privlači najviše pregleda na njihovoj službenoj YouTube stranici
<br>
- Prema broju komentara i like-ova najvažniji influenceri su AutoMarket.hr, Hanuma kocht i Slavica de Jong.

<br>

<button class="btn btn-primary" data-toggle="collapse" data-target="#Block10"> Tablica: Najvažniji autori na YouTube platformi. </button>  
<div id="Block10" class="collapse">

```{r , echo=FALSE, message=FALSE, warning=FALSE, fig.height = 8, fig.width=5}
phillips %>%
   mutate(kword = case_when(grepl("phill", mention, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", mention, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", mention, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", mention, ignore.case = TRUE) ~ "dyson")) %>%
  filter(type == "youtube") %>%
  group_by(kword,author) %>%
  summarise(View =  sum(view, na.rm = TRUE),
            Comment =  sum(comment, na.rm = TRUE),
        #    Engagement =  sum(engagement, na.rm = TRUE),
            Like =  sum(like, na.rm = TRUE),
        #    Virality =  sum(virality, na.rm = TRUE),
        #    prValue =  sum(prValue, na.rm = TRUE)
        ) %>%
  arrange(desc(View)) %>%
  rename (Brand = kword,
          'Autor' = author) %>%
  kbl() %>%
    kable_paper(bootstrap_options = "striped",full_width = F, position = "left")  %>%
     scroll_box(width = "450px", height = "400px") %>%
footnote(general = "*Broj objava u tekstu:") 
  
```

</div>

<br>

# **Izabrani brandovi**

***

<br>

U ovom dijelu je pregled sadržaja za Bosch na platformi YouTube i Phillips na Facebook-u.

```{r lexicon, echo=FALSE, message=FALSE, warning=FALSE}
## M-Files ----
# function to parse JSON from http conenctiion
parseJSON <- function(x) {
  xCon <- content(x, as = "text", type = "aplication/json", encoding = "UTF-8")
  xCon <- jsonlite::fromJSON(xCon, flatten = TRUE)
  xCon
}
# GET REST API function M-Files
mfiles_get <- function(token, resource){
  req <- GET(url = paste0('http://server.contentio.biz/REST', resource),
             add_headers('X-Authentication' = token, 'content-type' = "application/json"))
  result <- parseJSON(req)
  return(result)
}
# GET token M-Files
req <- POST(url = 'http://server.contentio.biz/REST/server/authenticationtokens.aspx', 
            config = add_headers('content-type' = "application/json"),
            body = list(Username = "msagovac", Password = "Wc8O10TaHz40",
                        VaultGuid = "{7145BCEB-8FE2-4278-AD3B-7AE70374FF8A}",
                        ComputerName  = "CT-VM-01"),
            encode = "json", verbose())
token <- parseJSON(req)[[1]]
# M-FILES DOWNLOAD FILES
mfiles_downlaod <- function(objType, objId, fileId) {
  req <- GET(url = paste0('http://server.contentio.biz/REST/objects/', objType, '/', 
                          objId, '/latest/files/',fileId , '/content'),
             add_headers('X-Authentication' = token))
  reqCon <- content(req, as = "text", encoding = "UTF-8")
  if (is.na(reqCon)) {
    reqCon <- content(req, as = "raw", encoding = "UTF-8")
    reqCon <- rawToChar(reqCon, multiple = FALSE)
    reqCon <- iconv(reqCon, "", "UTF-8")
  }
  reqCon
}
mfiles_downlaod_txt <- function(objType, objId, fileId, ext = ".csv") {
  req <- GET(url = paste0('http://server.contentio.biz/REST/objects/', objType, '/', 
                          objId, '/latest/files/',fileId , '/content'),
             add_headers('X-Authentication' = token))
  reqCon <- httr::content(req)
  tempFileSave <- paste0(tempfile(), ext)
  writeBin(reqCon, tempFileSave)
  return(tempFileSave)
}
# GET classess, props and others
prop <- mfiles_get(token, "/structure/properties")
prop <- prop %>% 
  select(DataType, ID, Name, ObjectType) %>% 
  dplyr::arrange(Name)
objs <- mfiles_get(token, "/structure/objecttypes")
mfilesClass <- mfiles_get(token, "/structure/classes")
CroSentilex_n <- read.delim(mfiles_downlaod_txt("0", 136679, 136711, ext = ".txt"),
                            header = FALSE,
                            sep = " ",
                            stringsAsFactors = FALSE) %>% 
  rename(word = "V1", sentiment = "V2" ) %>%
  mutate(brija = "NEG")
CroSentilex_p <- read.delim(mfiles_downlaod_txt("0", 136681, 136713, ext = ".txt"),
                            header = FALSE,
                            sep = " ",
                            stringsAsFactors = FALSE) %>% 
  rename(word = "V1", sentiment = "V2" ) %>%
  mutate(brija = "POZ")
Crosentilex_sve <- rbind(setDT(CroSentilex_n), setDT(CroSentilex_p))
#head(Crosentilex_sve)
CroSentilex_Gold  <- read.delim2(mfiles_downlaod_txt("0", 136680, 136712, ext = ".txt"),
                                 header = FALSE,
                                 sep = " ",
                                 stringsAsFactors = FALSE) %>%
  rename(word = "V1", sentiment = "V2" ) 
CroSentilex_Gold[1,1] <- "dati"
CroSentilex_Gold$sentiment <- str_replace(CroSentilex_Gold$sentiment , "-", "1")
CroSentilex_Gold$sentiment <- str_replace(CroSentilex_Gold$sentiment , "\\+", "2")
CroSentilex_Gold$sentiment <- as.numeric(unlist(CroSentilex_Gold$sentiment))
#head(CroSentilex_Gold)
# leksikoni
stopwords_cro <- get_stopwords(language = "hr", source = "stopwords-iso")
my_stop_words <- tibble(
  word = c(
    "jedan",
    "e","prvi", "dva","dvije","drugi",
    "tri","tre?i","pet","kod",
    "ove","ova",  "ovo","bez",
    "evo","oko",  "om", "ek",
    "mil","tko","?est", "sedam",
    "osam",   "?im", "zbog",
    "prema", "dok","zato", "koji", 
    "im", "?ak","me?u", "tek",
    "koliko", "tko","kod","poput", 
    "ba?", "dakle", "osim", "svih", 
    "svoju", "odnosno", "gdje",
    "kojoj", "ovi", "toga","ima","treba","sad","to","kad", "?e","ovaj","?ta","onda","ce","ko"
  ),
  lexicon = "lux"
)
stop_corpus <- my_stop_words %>%
  bind_rows(stopwords_cro)
```

<br>

### **Bosch** 

***

<br>

- Najvažnije riječi su: akcija, čipovi, cijena, *powered by Bosch*, končar, aparati,  bicikli i dr.

<br>

```{r , echo=FALSE, message=FALSE, warning=FALSE, fig.height = 10, fig.width=15}

library("readxl")
phillipstxt <- read_excel("./toolkitapp.xlsx")

phillipstxt %>%
   mutate(kword = case_when(grepl("phill", MENTION_SNIPPET, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", MENTION_SNIPPET, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", MENTION_SNIPPET, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", MENTION_SNIPPET, ignore.case = TRUE) ~ "dyson")) %>%
  filter(SOURCE_TYPE == "web" & kword == "bosch") %>%
  unnest_tokens(word, MENTION_SNIPPET) %>%
  anti_join(stop_corpus, by = "word") %>%
  mutate(word = gsub("\\d+", NA, word)) %>%
  mutate(word = gsub("^[a-zA-Z]$", NA, word)) %>%
  filter(!is.na(word)) -> rijeci_clean
```

<button class="btn btn-primary" data-toggle="collapse" data-target="#Block11"> Tablica: Najčešće riječi na Web-u o brandu Bosch. </button>  
<div id="Block11" class="collapse">

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height = 10, fig.width=5}

rijeci_clean %>%
#  filter(word %in% c("xiaomi","samsung","vivo","huawei")) %>%
  group_by(word) %>%
  summarise(#View =  sum(view, na.rm = TRUE),
            Virality =  sum(VIRALITY, na.rm = TRUE),
            Reach =  sum(REACH, na.rm = TRUE),
            Share =  sum(SHARE_COUNT, na.rm = TRUE),
          #  Virality =  sum(virality, na.rm = TRUE),
          #  prValue =  sum(prValue, na.rm = TRUE),
            n = n()) %>%
  arrange(desc(n))-> freqOFmention


freqOFmention %>%
  rename (Brand = word,
          'Number of mentions' = n) %>%
  kbl(caption = "Najčešće riječi na YouTubee o brandu Bosch") %>%
    kable_paper(bootstrap_options = "striped",full_width = F, position = "left")  %>%
     scroll_box(width = "450px", height = "400px") 



```

</div>

<br>

### **Phillips**

***

<br>

- Najrelevantnije riječi su: slušalice,brijač, brada, kamenac, kosa i dr.

```{r , echo=FALSE, message=FALSE, warning=FALSE, fig.height = 10, fig.width=15}

phillipstxt %>%
   mutate(kword = case_when(grepl("phill", MENTION_SNIPPET, ignore.case = TRUE) ~ "phillips",
                            grepl("bosch", MENTION_SNIPPET, ignore.case = TRUE) ~ "bosch",
                            grepl("braun", MENTION_SNIPPET, ignore.case = TRUE) ~ "braun",
                            grepl("dyson", MENTION_SNIPPET, ignore.case = TRUE) ~ "dyson")) %>%
  filter(SOURCE_TYPE == "facebook" & kword == "phillips") %>%
  unnest_tokens(word, MENTION_SNIPPET) %>%
  anti_join(stop_corpus, by = "word") %>%
  mutate(word = gsub("\\d+", NA, word)) %>%
  mutate(word = gsub("^[a-zA-Z]$", NA, word)) %>%
  filter(!is.na(word)) -> rijeci_clean
```

<br>

<button class="btn btn-primary" data-toggle="collapse" data-target="#Block12"> Tablica: Najčešće riječi na Facebook-u o brandu Phillips. </button>  
<div id="Block12" class="collapse">

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.height = 10, fig.width=5}

rijeci_clean %>%
#  filter(word %in% c("xiaomi","samsung","vivo","huawei")) %>%
  group_by(word) %>%
  summarise(Reach =  sum(REACH, na.rm = TRUE),
            FollowerCount =  sum(FOLLOWERS_COUNT, na.rm = TRUE),
         #   Engagement =  sum(engagement, na.rm = TRUE),
            Like =  sum(LIKE_COUNT, na.rm = TRUE),
            Comment =  sum(COMMENT_COUNT, na.rm = TRUE),
            ShareCount =  sum(SHARE_COUNT, na.rm = TRUE),
            n = n()) %>%
  arrange(desc(n))-> freqOFmention


freqOFmention %>%
  rename (Brand = word,
          'Number of mentions' = n) %>%
  kbl(caption = "Najčešće riječi na Facebook-u o brandu Phillips") %>%
    kable_paper(bootstrap_options = "striped",full_width = F, position = "left")  %>%
     scroll_box(width = "550px", height = "400px") 

```

</div>

<br>

# **Glavni zaključci**

***

<br>


<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 20px;}
</style>
<div class = "blue">

- Tržišni lider u medijskom prostoru je Bosch
- Braun nakon toga, a Phillips zaostaje
- U prosjeku ima oko 30 objava dnevno 
- Najviše se objavljuje na forumima i Web-u
- Prostor za rast na e-commerce stranicama i YouTube-u

</div>


</div>





