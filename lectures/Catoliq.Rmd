---
title: "Katoličke dezinformacije"
author: "Lux"
date: "2023-03-25"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r echo=F, eval=T, message=F , warning= FALSE, message=F}
library(tidyverse)
library(readxl)
library(xlsx)
library(here)
library(kableExtra)
library(DT)
library(purrr)
library(data.table)
library(tidytext)
library(dplyr)
library(lubridate)
library(anytime)
library(grid)
library(wordcloud)
library(reshape2)
library(ggraph)
library(widyr)
library(topicmodels)
library(ggthemes)
library(xlsx)

```

```{r echo=F, eval=F, message=F , warning= FALSE}
# fullDta <- fread("D:/LUKA/Freelance/Mediatoolkit/FULLDATA_NOTXT.csv")
# fullDtaTxt <- fread("D:/LUKA/Freelance/Mediatoolkit/FULLDATA_TXT.csv")
dt <- fread("D:/LUKA/Freelance/Mediatoolkit/MktFULLtxt.csv")


dt <- dt %>% filter(SOURCE_TYPE == "web") %>%
  distinct(URL,.keep_all = TRUE)

dt <- dt %>%
  mutate(V1 = as.numeric(V1)) %>%
  distinct(V1, .keep_all = T)# %>%
 # slice(1:300000) 


```



```{r}



generalno <- c("crkva", "biskup", "Kaptol", "časna sestra", "svećenik", "župnik", "vjernik", "kardinal", "papa", "sveti otac", "redovnik", "redovnica","kršćanstvo", "vjera", "Gospa", "Bog", "Isus", "katolički", "misa", "pričest", "krizma", "grijeh", "vjeroučitelj", "vjeronauk", "blagoslov","svjedočanstvo", "relikvija", "stigma", "duhovnost", "don", "fra", "velečasni","zaređenje", "krunica", "vjeronauk", "ukazanje")


generalno <- c("crkva", "biskup", "Kaptol", "časna sestra", "svećenik", "župnik", "vjernik", "kardinal", "papa", "sveti otac", "redovnik", "redovnica","kršćanstvo", "vjera", "Gospa", "Bog", "Isus", "katolički", "misa", "pričest", "krizma", "grijeh", "vjeroučitelj", "vjeronauk", "blagoslov","svjedočanstvo", "relikvija", "stigma", "duhovna zvanja", "velečasni","zaređenje", "krunica", "vjeronauk", "ukazanje")


imena <- c("Stepinac","don Damir Stojić", "Željka Markić", "pater Ike Mandurić","Vlado Košić","Robert Bajruši", "Inoslav Bešker", "Ante Tomić", "Branimir Pofuk", "Igor Lasić", "Hrvoje Marjanović","Bozanić", "Ksenija Abramović", "Drago Pilsel")

institucije  <- c("Ksaver", "HBK", "Opus Dei", "Udruga Protagora","Caritas")

pravno <- c("vatikanski ugovori", "plaćanje blagoslova"," plaćanje sakramenata", "crkvene nekretnine", "crkvena imovina")

politika <- C("Hod za život", "U ime obitelji", "prolife", "poništenje Rimskih ugovora", "sekularizacija", "sekularna država", "klerikalizam", "Crkva ruši vlast", "veličaju ustaštvo", "oduzimaju prava ženama", "žele stvoriti katoličku državu", "crkvena afera", "zataškavanje Kaptola", "šutnja Kaptola", "Rimski ugovori","vjeronauk u školama", "vatikanski ugovori", "vatikanska banka" ,"klerikalna vlast","država nije odvojena od Crkve", "potiče homofobiju", "rodna ideologija", "klerikalizam", "ravnozemljaši", "gay brak", "podržavali ustaše", "podržavali naciste", "blagoslovili rat", "Hrvatska nije sekularna država","Katolička crkva vlada Hrvatskom","žene u Crkvi")

fraze <- c("pedofilija", "klečavci", "kaptolaši", "popovi lopovi", "zatucani katolici", "katolički fanatici", "katolički fašisti", "katolibani","crkvenjak", "ekstremni vjernici")

pomocno <- c( "smijenjen","konzervativci", "tradicionalisti", "pobačaj", "abortus", "aktivisti", "aktivizam", "jezuiti", "nazadan", "zaostao", "neobrazovan", "privilegije" , "privilegiran", "diskriminacija", "nacionalizam", "nacionalisti", "ekstremisti", "otpušten", "prekrštavanje", "izopćen", "izbačen", "bludničio",  "posvećenje",  , "inkardiniran", "inkardinacija",  "mračno doba", "razotkrio", "prijavio", "bludničio", "pronevjerio", "homofobijam", "zlodjela", "progoni", "dogma", "kontroverzni svećenik", "moderni svećenik", "tolerantna vjera", "vjerska policija", "vjerska kontrola", "crkveni mediji", "vjerski mediji", "ukidanje", "homofob", "pedofil", "homoseksualnost", "patrijarhat", "čudesno ozdravljenje", "čudo")

 
  
nesvrstano <-  c("Novosti", "Progledaj srcem" ,"Autograf", "David", "vjera.hr")







```


```{r}


pattern <- str_c("\\b(", str_c(generalno, collapse = "|"), ")\\b")


# Define the batch size
batch_size <- 10000

# Split your data into batches
batches <- split(dt, ceiling(seq_along(dt[[1]])/batch_size))

# Function to process each batch
process_batch <- function(batch) {
  batch %>%
    as_tibble() %>%
    select(V1, DATE, TITLE, URL, FULL_TEXT) %>%
    mutate(
      full_text = tolower(FULL_TEXT),
      match = str_c(generalno, collapse = '|'),
      key_word = str_extract_all(full_text, match)
    ) %>%
    filter(lengths(key_word) > 0) %>%
    unnest(key_word) %>%
    distinct(V1, .keep_all = TRUE)
}

# Process each batch
results <- batches %>%
  map(~ process_batch(.x))

df <- bind_rows(results)

filtered_df <- df %>%
  filter(str_detect(full_text, pattern))


write.csv2(filtered_df, file = "D:/LUKA/Freelance/Mediatoolkit/catholiq.csv", row.names = T)

# Install the writexl package if you haven't already
install.packages("writexl")

# Load the writexl package
library(writexl)

write_xlsx(filtered_df, path = "D:/LUKA/Freelance/Mediatoolkit/catholiq.xlsx")
```




```{r}

proba <- as_tibble(dt) %>%
  select(V1, DATE, TITLE, URL, FULL_TEXT) %>%
  mutate(full_text = tolower(dt$FULL_TEXT),
         match = str_c(generalno, collapse = '|'),
         key_word = str_extract_all(full_text, match)) %>%
  select(-match) %>%
  filter(lengths(key_word)>0) %>%
  unnest(key_word) %>%
  distinct(V1, .keep_all = T)


pattern <- str_c("\\b(", str_c(generalno, collapse = "|"), ")\\b")

filtered_df <- proba %>%
  filter(str_detect(full_text, pattern))

filtered_df %>% group_by(key_word) %>% count() %>% arrange(desc(n))
```






```{r}


dta <- dt %>%
 # filter(SOURCE_TYPE =="web")  %>%
  filter(str_detect(FULL_TEXT,fixed("crkva",ignore_case = TRUE)))





dta <- dt %>%
  filter(SOURCE_TYPE =="web")  %>%
  filter(str_detect(URL,fixed("836688",ignore_case = TRUE)))


activity <- dta %>%
  group_by(FROM) %>%
  summarise(count = n()) %>%
  mutate(percent = round(count / sum(count) * 100,2)) %>% 
  arrange(desc(count))

datatable(activity, options = list(scrollX = TRUE, scrollY = "500px"))


dta %>% 
  select(DATE,TIME,TITLE,FROM,AUTHOR,URL, FULL_TEXT) %>%
  datatable(., options = list(scrollX = TRUE, scrollY = "500px"))



```


